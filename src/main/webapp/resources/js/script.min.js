app.moviesModule=angular.module("detailMovieController",[]);app.moviesModule.controller("detailMovieCtrl",function(a,d,c,e,b){c.cantidad=3;if(d.idMovie!=0){c.movie={id:3,name:"Metegol",description:"All Boys espera al ganador entre los Bodegueros y el equipo del Viaducto, en la semifinal. En la otra llave lucharan por un lugar en la final el sorprendente Estudiantes de Buenos Aires milita en la B Metropolitana y es el unico de los cuatro que no es de Primera y San Lorenzo.",urlImage:"./resources/img/movies/1.jpg",urlTrailer:"http://www.youtube.com/embed/30v_FQxGmaA",actors:"Pablo Rago, Miguel Angel Rodriguez, Fabian Gianola, Horacio Fontova",genre:"Comedy"}}});app.directivesModule=angular.module("utilsDirective",[]).directive("makeChairs",function(){return{restrict:"A",template:'<ul class="chair"><li class="chairValue">{{chairValue}}</li><li ng-repeat="chair in chairs" ng-class="chair" ng-click="toggle($index)"></li></ul>',scope:{chairValue:"=",max:"=",onChairSelected:"&"},link:function(c,d,a){var b=function(){c.chairs=[];for(var e=0;e<c.max;e++){c.chairs.push({filled:e<c.chairValue,empty:e>=c.chairValue})}};c.toggle=function(e){if(e==0){return}if(c.chairValue==(e+1)){c.chairValue=e;c.onChairSelected({chair:e})}else{c.chairValue=e+1;c.onChairSelected({chair:e+1})}};c.$watch("chairValue",function(e,f){if(f){b()}})}}});describe("$httpBasedService",function(){var b,a;beforeEach(function(){module("theaterService");inject(function(d,c){b=c;a=d})});afterEach(function(){a.verifyNoOutstandingExpectation();a.verifyNoOutstandingRequest()});it("should send the msg and return the response.",function(){var c=[{id:1}];a.expectGET("./resources/json/mock.json").respond(c);var e={handler:function(){}};spyOn(e,"handler");var d=b.getTheaters();d.then(e.handler);a.flush();expect(e.handler).toHaveBeenCalledWith(c)})});app.moviesModule=angular.module("moviesController",[]);app.moviesModule.controller("moviesCtrl",function(a,d,c,e,b){c.movies=[{id:1,name:"Que paso ayer 1",url:"./resources/img/movies/1.jpg"},{id:2,name:"Metegol",url:"./resources/img/movies/2.jpg"},{id:3,name:"Que paso ayer 2",url:"./resources/img/movies/3.jpg"},{id:4,name:"Metegol 1",url:"./resources/img/movies/4.jpg"},{id:5,name:"Que paso ayer 2",url:"./resources/img/movies/5.jpg"},{id:6,name:"Metegol 1",url:"./resources/img/movies/6.jpg"}]});app.factory("movieService",function(a){return{getMovies:function(){var b=a.get(app.constantsGlobal.REST_MOVIE).then(function(c){return c.data});return b},getMovie:function(c){var b=a.get(app.constantsGlobal.REST_MOVIE+"/"+c).then(function(d){return d.data});return b},getSities:function(){var c="urldespues";var b=a.get(c).then(function(d){return d.data});return b}}});app.moviesModule=angular.module("stepSelectMovieController",[]);app.moviesModule.controller("reservationMovieCtrl",function(b,e,d,f,a){d.filter={};var c="/steps?";d.labelButton="BUY";d.getTheaters=function(){a.getTheaters().then(function(g){d.theaters=g})};d.updateTheaterSelected=function(){a.getMovies(d.filter.theaterSelected.id).then(function(g){d.movies=g;c+="theater="+d.filter.theaterSelected.id});d.filter.movieSelected=false;d.filter.showTimeSelected=false};d.updateMovieSelected=function(){var j=d.filter.theaterSelected.id;var g=d.filter.movieSelected.id;c+="&movie="+g;a.getShowTimeofMovies(j,g).then(function(l){d.showTimes=new Array();for(var k=0;k<l.length;k++){d.showTimes.push(l[k].showTime)}});for(var h=0;h<d.movies.length;h++){if(g==d.movies[h].id){d.description=d.movies[h].description;break}}d.filter.showTimeSelected=false};d.updateShowTimeSelected=function(){c+="&showTime="+d.filter.showTimeSelected.id};d.navigateUrl=function(){f.url(c)};d.getTheaters()});app.moviesModule=angular.module("stepSelectPaymentController",[]);app.moviesModule.controller("paymentCtrl",function(a,d,c,e,b){c.methodsPayment=[{id:1,name:"Amex"},{id:2,name:"Cabal"},{id:3,name:"Mastercard"},{id:4,name:"Visa"}];c.lastStep=function(f){c.shouldBeOpen=true;console.log(f)};c.close=function(){c.shouldBeOpen=false};c.items=["item1","item2"];c.opts={backdropFade:true,dialogFade:true}});app.moviesModule=angular.module("stepSelectSitieController",[]);app.moviesModule.controller("sitiesCtrl",function(g,h,i,c,d){i.quantity=1;var b="OTHER",f="MY",e="FREE";g.createSections=function(j){i.sections=new Array();i.sizeScreen=0;i.occupiedSession=0;i.quantity=1;i.sitiesSelected=new Array();i.mapSitiesSelected={};a(j.left[0],"LEFT");a(j.center[0],"CENTER");a(j.right[0],"RIGHT");i.sizeScreen=i.sizeScreen+(i.sections.length*20)-20};i.updateSitie=function(j){if(j.occupied==f){i.occupiedSession-=1;j.occupied=e;j.url="resources/img/seat_gray.gif";delete i.mapSitiesSelected[j.row+"-"+j.column+"-"+j.nameSection];return}if(i.quantity<=i.occupiedSession){return}if(!(j.occupied==b)){i.occupiedSession+=1;j.occupied=f;j.url="resources/img/seat_green.gif";i.sitiesSelected.push(j);i.mapSitiesSelected[j.row+"-"+j.column+"-"+j.nameSection]=j;return}};function a(r,p){var k=r.row;var t=r.column;var l=new Array();var q={};if(r.occupied){for(var o=0;o<r.occupied.length;o++){var u=r.occupied[o].row;var m=r.occupied[o].column;q[u+"-"+m]=true}}for(var o=0;o<k;o++){for(var n=0;n<t;n++){var s=new Object();s.row=o;s.column=n;s.nameSection=p;if(o+"-"+n in q){s.url="resources/img/seat_red.gif";s.occupied=b}else{s.url="resources/img/seat_gray.gif";s.occupied=e}l.push(s)}}var r=new Object();r.nameSection=p;r.sities=l;r.size=t*24;i.sizeScreen+=r.size;i.sections.push(r)}});app.factory("theaterService",function(b){var a="./resources/json/mock.json";return{getTheaters:function(){var c=b.get(a).then(function(d){var e=[{id:1,name:"Palmares"},{id:2,name:"Shopping"},{id:3,name:"Desde Servicio Este"}];return e});return c},getMovies:function(d){var c=b.get(a).then(function(e){var f;if(d==1){f=[{id:1,name:"Jobs",description:"description 1"},{id:2,name:"Mi villano Favorito 2",description:"descripcion 2"}]}else{f=[{id:3,name:"Que paso ayer 1",description:"descripcion 3"},{id:4,name:"Metegol",description:"descripcion 4"}]}return f});return c},getShowTimeofMovies:function(e,d){var c=b.get(a).then(function(f){var g=[{movie:{id:2304,title:"lalala"},theater:{id:30,name:"cinemark palmares"},showTime:{schedule:"17:00 primnera",id:1,left:[{row:20,column:2,occupied:[{row:1,column:1}],}],center:[{row:20,column:20,occupied:[{row:1,column:4},{row:1,column:5},{row:6,column:7},{row:3,column:2},{row:5,column:4}]}],right:[{row:20,column:3,occupied:[{row:1,column:3}]}]}},{movie:{id:2304,title:"lalala"},theater:{id:30,name:"cinemark palmares"},showTime:{schedule:"17:00 segunda",id:2,left:[{row:20,column:4,occupied:[{row:1,column:1}],}],center:[{row:20,column:20,occupied:[{row:1,column:4}]}],right:[{row:20,column:3,occupied:[{row:1,column:2}]}]}}];return g});return c}}});app.moviesModule=angular.module("tplReservationMovieController",[]);app.moviesModule.controller("reservationCtrl",function(a,d,c,e,b){c.templates=[{name:"filtroSesiones",url:"resources/tpl/gridMovies.html",state:true},{name:"tablaSesiones",url:"resources/tpl/stepSelectMovie.html",state:true}]});app.moviesModule=angular.module("tplStepsController",[]);app.moviesModule.controller("stepsCtrl",function(b,d,c,e,a){c.templates=[{name:"stepSelectMovie",url:"resources/tpl/stepSelectMovie.html",state:true},{name:"stepSelectSitie",url:"resources/tpl/stepSelectSitie.html",state:false},{name:"stepSelectPayment",url:"resources/tpl/stepSelectPayment.html",state:false}];c.labelButton="NEXT";c.filter={};if(!d.movie){a.getTheaters().then(function(f){c.theaters=f})}if(d.movie&&d.theater&&d.showTime){c.filter={};a.getTheaters().then(function(g){c.theaters=g;for(var f=0;f<c.theaters.length;f++){if(c.theaters[f].id==d.theater){c.filter.theaterSelected=c.theaters[f];break}}a.getMovies(d.theater).then(function(h){c.movies=h;for(var j=0;j<c.movies.length;j++){if(c.movies[j].id==d.movie){c.filter.movieSelected=c.movies[j];c.description=c.movies[j].description;break}}a.getShowTimeofMovies(d.theater,d.movie).then(function(l){c.showTimes=new Array();for(var k=0;k<l.length;k++){c.showTimes.push(l[k].showTime)}for(var k=0;k<c.showTimes.length;k++){if(c.showTimes[k].id==d.showTime){c.filter.showTimeSelected=c.showTimes[k];break}}})})})}c.navigateUrl=function(){c.templates[1].state=true;b.createSections(c.filter.showTimeSelected)};c.updateTheaterSelected=function(){a.getMovies(c.filter.theaterSelected.id).then(function(f){c.movies=f});c.filter.movieSelected=false;c.filter.showTimeSelected=false;c.templates[1].state=false;c.templates[2].state=false};c.updateMovieSelected=function(){var h=c.filter.theaterSelected.id;var f=c.filter.movieSelected.id;a.getShowTimeofMovies(h,f).then(function(k){c.showTimes=new Array();for(var j=0;j<k.length;j++){c.showTimes.push(k[j].showTime)}});for(var g=0;g<c.movies.length;g++){if(f==c.movies[g].id){c.description=c.movies[g].description;break}}c.filter.showTimeSelected=false;c.templates[1].state=false;c.templates[2].state=false};c.nextStep=function(g){c.filter.sitiesSelectedText="";c.filter.quantitySelected=0;for(var f in g){c.filter.sitiesSelectedText=c.filter.sitiesSelectedText+g[f].nameSection+": ("+(g[f].row+1)+","+(g[f].column+1)+") ";c.filter.quantitySelected++}c.templates[2].state=true};c.lastStep=function(f){b.open(f)}});