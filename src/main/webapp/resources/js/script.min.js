app.moviesModule=angular.module("detailMovieController",[]);app.moviesModule.controller("detailMovieCtrl",function(a,d,c,e,b){c.no_picture="./resources/img/no-picture.jpg";if(d.idMovie!=0){b.getMovie(d.idMovie).then(function(f){c.movie=f})}});app.directivesModule=angular.module("utilsDirective",[]).directive("makeChairs",function(){return{restrict:"A",template:'<ul class="chair"><li class="chairValue">{{chairValue}}</li><li ng-repeat="chair in chairs" ng-class="chair" ng-click="toggle($index)"></li></ul>',scope:{chairValue:"=",max:"=",onChairSelected:"&"},link:function(c,d,a){var b=function(){c.chairs=[];for(var e=0;e<c.max;e++){c.chairs.push({filled:e<c.chairValue,empty:e>=c.chairValue})}};c.toggle=function(e){if(e==0){return}if(c.chairValue==(e+1)){c.chairValue=e;c.onChairSelected({chair:e})}else{c.chairValue=e+1;c.onChairSelected({chair:e+1})}};c.$watch("chairValue",function(e,f){if(f){b()}})}}}).directive("ngWidth",function(){return function(b,c,a){a.$observe("ngWidth",function(d){c.attr("width",d)})}}).directive("ngHeight",function(){return function(b,c,a){a.$observe("ngHeight",function(d){c.attr("height",d)})}}).directive("cinema",function(){return{restrict:"E",template:'<div id="divImgCinema"><img alt="" ng-src="{{imgScreen}}"  ng-style="{\'width\': sizeScreen}"></div><div id="divSectionCinema" ng-style="{\'padding-right\': section.padding_right}" ng-repeat="section in sections"><div ng-style="{\'width\': section.size}"><span class="ng-scope" ng-repeat="sitie in section.sities"><img ng-src="{{sitie.url}}" ng-width="{{ngSize}}" ng-height="{{ngSize}}" ng-click="updateSitie(sitie)"></span></div></div>',scope:{sectors:"=",max:"=",ngSize:"=",selected:"=",},link:function(b,d,a){if(!a.imgFree||!a.imgSelected||!a.imgTaken||!a.max||!a.ngSize||!a.sectors||!a.selected){throw Error(NOT_POSSESS_ALL_THE_REQUIRED_PROPERTIES)}var e=function(){var p=b.sectors;b.takenSession=0;b.sizeScreen=0;b.sections=new Array();b.selected={};for(var t=0;t<p.length;t++){var h=new Array();var n={};if(p[t].takenSeats){for(var m=0;m<p[t].takenSeats.length;m++){var r=p[t].takenSeats[m].row;var k=p[t].takenSeats[m].column;n[r+"-"+k]=true}}for(var m=0;m<p[t].rows;m++){for(var l=0;l<p[t].cols;l++){var q=new Object();q.row=m;q.col=l;q.nameSection=p[t].name;q.url=a.imgFree;if(m+"-"+l in n){q.url=a.imgTaken;q.taken=c}else{q.url=a.imgFree;q.taken=f}h.push(q)}b.sections.sities=h}var o=new Object();o.nameSection=p[t].name;o.sities=h;o.size=p[t].cols*b.ngSize;o.padding_right=b.ngSize;b.sizeScreen+=o.size;b.sections.push(o)}b.sizeScreen=b.sizeScreen+(b.sectors.length*b.ngSize)-b.ngSize;b.imgScreen=a.imgScreen};var c="OTHER",g="MY",f="FREE";b.updateSitie=function(i){if(i.taken==g){b.takenSession-=1;i.taken=f;i.url=a.imgFree;delete b.selected[i.row+"-"+i.col+"-"+i.nameSection];return}if(b.max<=b.takenSession){return}if(!(i.taken==c)){b.takenSession+=1;var h=new Object();h.row=i.row;h.col=i.col;h.nameSection=i.nameSection;b.selected[h.row+"-"+h.col+"-"+h.nameSection]=h;i.taken=g;i.url=a.imgSelected;return}};b.$watch("sectors",function(h,i){if(h){e()}})}}});app.moviesModule=angular.module("moviesController",["ui.bootstrap"]);app.moviesModule.controller("moviesCtrl",function(a,d,c,e,b){c.moviesAll;c.noOfPages=1;c.currentPage=1;c.maxSize=6;c.no_picture="./resources/img/no-picture.jpg";c.moviesList=function(){b.getMovies().then(function(f){if(f==""){c.moviesAll=new Array()}else{c.moviesAll=f;c.noOfPages=Math.floor(c.moviesAll.length/c.maxSize)+1;if((c.moviesAll.length%c.maxSize)==0){c.noOfPages=c.noOfPages-1}c.pageChanged(1)}})};c.$watch("currentPage",function(f){c.watchPage=f});c.pageChanged=function(f){c.callbackPage=f;if(c.moviesAll){c.movies=c.moviesAll.slice((f-1)*6,f*6)}};c.moviesList()});app.factory("movieService",function(a){a.defaults.useXDomain=true;return{getMovies:function(){var b=a.get(app.constantsGlobal.REST_MOVIES).then(function(c){return c.data});return b},getMovie:function(c){var b=a.get(app.constantsGlobal.REST_MOVIES+"/"+c).then(function(d){return d.data});return b}}});app.factory("paymentsService",function(a){a.defaults.useXDomain=true;return{paymentReservation:function(e){var d="";for(var c in e.sitiesSelected){d=d+"&seat="+e.sitiesSelected[c].row+","+e.sitiesSelected[c].col+","+e.sitiesSelected[c].nameSection}var b=a.post(app.constantsGlobal.REST_PAYMENTS+"?schedule="+e.showTimeSelected.id+"&email="+e.email+"&dni="+e.dni+d).then(function(f){return f.data});return b}}});app.factory("showTimeService",function(a){a.defaults.useXDomain=true;return{getShowTimeofMovies:function(d,c){var b=a.get(app.constantsGlobal.REST_SHOW_TIMES+"?movie="+c+"&theater="+d).then(function(e){return e.data});return b}}});app.moviesModule=angular.module("stepPaymentConfirmationController",[]);app.moviesModule.controller("paymentConfirmationCtrl",function(a,b){a.showPaymentConfirmation=function(c){b.info=c}});app.moviesModule=angular.module("stepSelectMovieController",[]);app.moviesModule.controller("reservationMovieCtrl",function(b,e,c,f,a,d){c.filter={};c.showButton=true;c.getTheaters=function(){a.getTheaters().then(function(g){c.theaters=g})};c.updateTheaterSelected=function(){a.getMovies(c.filter.theaterSelected.id).then(function(g){c.movies=g});c.filter.movieSelected=false;c.filter.showTimeSelected=false};c.updateMovieSelected=function(){var j=c.filter.theaterSelected.id;var g=c.filter.movieSelected.id;d.getShowTimeofMovies(j,g).then(function(l){c.showTimes=new Array();for(var k=0;k<l.length;k++){c.showTimes.push(l[k])}});for(var h=0;h<c.movies.length;h++){if(g==c.movies[h].id){c.summary=c.movies[h].summary;break}}c.filter.showTimeSelected=false};c.updateShowTimeSelected=function(){};c.navigateUrl=function(){var g="/steps?theater="+c.filter.theaterSelected.id+"&movie="+c.filter.movieSelected.id+"&showTime="+c.filter.showTimeSelected.id;f.url(g)};c.getTheaters()});app.moviesModule=angular.module("stepSelectPaymentController",[]);app.moviesModule.controller("paymentCtrl",function(a,d,b,e,c){b.methodsPayment=[{id:1,name:"Amex"},{id:2,name:"Cabal"},{id:3,name:"Mastercard"},{id:4,name:"Visa"}];b.lastStep=function(){c.paymentReservation(b.filter).then(function(f){b.filter.confirmation=new Object();b.filter.confirmationCode=f.code;if(b.$parent.lastStep){b.$parent.lastStep(b.filter)}})}});app.moviesModule=angular.module("stepSelectSitieController",[]);app.moviesModule.controller("sitiesCtrl2",function(a,d,c,e,b){c.quantity=1;a.createSections=function(f){c.sections=app.utils.parseSectionCinema(f)};c.showNext=function(){var h=0;var f=false;for(var g in c.sitiesSelected){h++}if(h==c.quantity){f=true}return f}});app.moviesModule.controller("sitiesCtrl",function(j,k,l,d,g){l.quantity=1;var c="OTHER",i="MY",h="FREE";var f="Left",e="Center",a="Right";l.createSections=function(m){l.sections=new Array();l.sizeScreen=0;l.occupiedSession=0;l.quantity=1;l.sitiesSelected=new Array();l.mapSitiesSelected={};if(m.left){b(m.left,f)}if(m.center){b(m.center,e)}if(m.right){b(m.right,a)}l.sizeScreen=l.sizeScreen+(l.sections.length*20)-20};l.updateSitie=function(m){if(m.occupied==i){l.occupiedSession-=1;m.occupied=h;m.url="resources/img/seat_gray.gif";delete l.mapSitiesSelected[m.row+"-"+m.col+"-"+m.nameSection];return}if(l.quantity<=l.occupiedSession){return}if(!(m.occupied==c)){l.occupiedSession+=1;m.occupied=i;m.url="resources/img/seat_green.gif";l.sitiesSelected.push(m);l.mapSitiesSelected[m.row+"-"+m.col+"-"+m.nameSection]=m;return}};function b(t,r){var m=t.rows;var v=t.cols;var n=new Array();var s={};if(t.takenSeats){for(var q=0;q<t.takenSeats.length;q++){var w=t.takenSeats[q].row;var o=t.takenSeats[q].column;s[w+"-"+o]=true}}for(var q=0;q<m;q++){for(var p=0;p<v;p++){var u=new Object();u.row=q;u.col=p;u.nameSection=r;if(q+"-"+p in s){u.url="resources/img/seat_red.gif";u.occupied=c}else{u.url="resources/img/seat_gray.gif";u.occupied=h}n.push(u)}}var t=new Object();t.nameSection=r;t.sities=n;t.size=v*24;l.sizeScreen+=t.size;l.sections.push(t)}});app.factory("theaterService",function(a){a.defaults.useXDomain=true;return{getTheaters:function(){var b=a.get(app.constantsGlobal.REST_THEATERS).then(function(c){return c.data});return b},getMovies:function(c){var b=a.get(app.constantsGlobal.REST_THEATERS+"/"+c+"/movies").then(function(d){return d.data});return b}}});app.moviesModule=angular.module("tplReservationMovieController",[]);app.moviesModule.controller("reservationCtrl",function(b,d,c,e,a){c.templates=[{name:"gridMovies",url:"resources/tpl/gridMovies.html",state:true},{name:"stepSelectMovie",url:"resources/tpl/stepSelectMovie.html",state:true}];c.getTheaters=function(){a.getTheaters().then(function(f){c.theaters=f})};c.getTheaters()});app.moviesModule=angular.module("tplStepsController",[]);app.moviesModule.controller("stepsCtrl",function(b,e,c,f,a,d){c.templates=[{name:"stepSelectMovie",url:"resources/tpl/stepSelectMovie.html",state:true},{name:"stepSelectSitie",url:"resources/tpl/stepSelectSitie.html",state:false},{name:"stepSelectPayment",url:"resources/tpl/stepSelectPayment.html",state:false},{name:"stepPaymentConfirmation",url:"resources/tpl/stepPaymentConfirmation.html",state:false}];c.filter={};c.showButton=false;if(!e.movie){a.getTheaters().then(function(g){c.theaters=g})}if(e.movie&&e.theater&&e.showTime){c.filter={};a.getTheaters().then(function(h){c.theaters=h;for(var g=0;g<c.theaters.length;g++){if(c.theaters[g].id==e.theater){c.filter.theaterSelected=c.theaters[g];break}}a.getMovies(e.theater).then(function(j){c.movies=j;for(var k=0;k<c.movies.length;k++){if(c.movies[k].id==e.movie){c.filter.movieSelected=c.movies[k];c.summary=c.movies[k].summary;break}}d.getShowTimeofMovies(e.theater,e.movie).then(function(m){c.showTimes=new Array();for(var l=0;l<m.length;l++){c.showTimes.push(m[l])}for(var l=0;l<c.showTimes.length;l++){if(c.showTimes[l].id==e.showTime){c.filter.showTimeSelected=c.showTimes[l];break}}c.templates[1].state=true;b.createSections(c.filter.showTimeSelected)})})})}c.navigateUrl=function(){c.templates[1].state=true;b.createSections(c.filter.showTimeSelected)};c.updateTheaterSelected=function(){a.getMovies(c.filter.theaterSelected.id).then(function(g){c.movies=g});c.filter.movieSelected=false;c.filter.showTimeSelected=false;c.templates[1].state=false;c.templates[2].state=false};c.updateMovieSelected=function(){var j=c.filter.theaterSelected.id;var g=c.filter.movieSelected.id;d.getShowTimeofMovies(j,g).then(function(l){c.showTimes=new Array();for(var k=0;k<l.length;k++){c.showTimes.push(l[k])}});for(var h=0;h<c.movies.length;h++){if(g==c.movies[h].id){c.summary=c.movies[h].summary;break}}c.filter.showTimeSelected=false;c.templates[1].state=false;c.templates[2].state=false};c.updateShowTimeSelected=function(){c.navigateUrl()};c.nextStep=function(h){c.filter.sitiesSelectedText="";c.filter.quantitySelected=0;c.filter.sitiesSelected=h;for(var g in h){c.filter.sitiesSelectedText=c.filter.sitiesSelectedText+h[g].nameSection+": ("+(h[g].row+1)+","+(h[g].col+1)+") ";c.filter.quantitySelected++}c.templates[2].state=true};c.lastStep=function(g){c.templates[0].state=false;c.templates[1].state=false;c.templates[2].state=false;c.templates[3].state=true;b.showPaymentConfirmation(g)}});